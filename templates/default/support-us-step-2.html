<py:extends href="../support.html" py:whitespace="strip">
<py:block name="banner"/>
<py:block name="content">
    <style type="text/css">
    .RadioChoice {
        display: none;
    }
    .RadioChoice + * {
        opacity: 0.9;
        transition: all 0.3s;
        padding: 10px;
        width: 100%;
        height: 100%;
        text-align: center;
    }
    .RadioChoice:checked + * {
        opacity: 1;
        outline: 2px solid #fff;
    }
    .PhotoChooser {
        display: flex;
        justify-content: space-between;
        margin-right: -10px;
    }
    .PhotoChooser > * {
        margin-right: 10px;
    }
    .PhotoChooser > *:hover {
        opacity: 1;
        outline: 2px solid #fff;
        cursor: zoom-in;
    }
    .PhotoChooser label:hover {
        cursor: pointer;
    }
    .PhotoChooser * {
        flex: 1 1 28%;
    }
    .PhotoChooser-Upload  {
        flex: 1 1 44%;
    }
    .filepond--label-action {
        display: block;
    }
    .filepond--panel-root {
        border-radius: 3px !important;
    }
    .no-picture-please {
        opacity: 0.5;
        max-width: 100px;
    }
    .label-top {
        display: block;
        margin-bottom: 10px;
    }
    </style>
    <link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css" rel="stylesheet"/>
    <link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet"/>
    <script src="https://unpkg.com/filepond-plugin-image-exif-orientation/dist/filepond-plugin-image-exif-orientation.js"></script>
    <script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>
    <script src="https://unpkg.com/filepond/dist/filepond.js"></script>
    <script src="https://unpkg.com/htmx.org@0.0.4"></script>
    <script>
    ready(function () {
        FilePond.registerPlugin(FilePondPluginImageExifOrientation);
        FilePond.registerPlugin(FilePondPluginImagePreview);
        FilePond.setOptions({server: '${urlfor("filepond-upload")}'});
        var inputElement = document.querySelector('input[type="file"]');
        var pond = FilePond.create(inputElement);
        pond.labelIdle = 'glisser-déposer ou <span class="filepond--label-action">choisir une photo</span>';

        document.querySelectorAll(".RadioChoice+*").forEach(function (node) {
            node.addEventListener("click", function () {
                document.getElementById(node.getAttribute("for")).checked = true;
             });
        });
    });
    </script>
    <div class="wrapper">
        <div class="container">
            <div class="u-Constrained u-Constrained-m">
                <h1 py:block="heading"></h1>
                <form method="POST">
                    <input type="hidden" name="step" value="$step"/>
                    <div py:block="form" class="BlockBg js-form-target u-Spaced">
                        <h3 class="form-section-title">Infos statistiques</h3>
                        <p class="form-section-explanation">
                            Ces champs seront uniquement utilisés à des fins statistiques.
                        </p>
                        <label>
                            <select name="year_of_birth">
                                <option>Année de naissance…</option>
                                <py:for each="(start, end), selected in year_of_birth_range_options">
                                    <option value="${json([start, end])}" selected="${1 if selected else None}">
                                        <py:choose>
                                            <py:when test="start is None">avant $end</py:when>
                                            <py:when test="end is None">$start ou après</py:when>
                                            <py:otherwise>$start – ${end - 1}</py:otherwise>
                                        </py:choose>
                                    </option>
                                </py:for>
                            </select>
                        </label>
                        <label>
                            <select name="occupation_id">
                                <option>Je suis…</option>
                                <option
                                    py:for="value, label in occupation_options"
                                    value="$value"
                                    selected="${1 if value == supporter.occupation_id else None}"
                                >$label</option>
                            </select>
                        </label>
                        <hr />
                        <h3 class="form-section-title">Infos publiques</h3>
                        <p class="form-section-explanation">
                            Montrer qui soutient - et pourquoi - aidera d'autres à
                            vous rejoindre.
                        </p>
                        <label>
                            Nom (ou pseudo)
                            <input name="display_name" type="text" value="${supporter.display_name or supporter.full_name}" placeholder="Prénom + nom (ou pseudo)"/>
                        </label>
                        <div class="u-Flex u-Flex-justifyBetween PhotoChooser" py:with="selected = 'existing' if supporter.display_image else 'none'">
                            <div py:if="bool(supporter.display_image)">
                                <!--! user has previously uploaded a photo or selected to show their social media photo -->
                                <input id="photo-existing" class="RadioChoice" type="radio" name="photo-option" value="existing" checked="${1 if selected == 'existing' else None}"/>
                                <label for="photo-existing" class="photo-existing">
                                    <span class="label-top">Votre photo</span>
                                    <img src="${supporter.display_image_url()}" style="max-width: 4em"/>
                                </label>
                            </div>
                            <div>
                                <input id="photo-none" type="radio" class="RadioChoice" name="photo-option" value="none" checked="${1 if selected == 'none' else None}"/>
                                <label for="photo-none">
                                    <span class="label-top">Pas de photo</span>
                                    <img class="no-picture-please" src="${static('img/no-picture-please.svg')}" />
                                </label>
                            </div>
                            <div py:if="bool(supporter.image_path)">
                                <!-- photo previously uploaded (but deselected) or social media photo -->
                                <input id="photo-existing" class="RadioChoice" type="radio" name="photo-option" value="existing" checked="${1 if selected == 'existing' else None}"/>
                                <label for="photo-existing" style="width: 100%; height: 100%;" class="photo-existing">
                                    <span class="label-top">Votre photo</span>
                                    <img src="${supporter.uploaded_image_url()}" style="max-width: 4em"/>
                                </label>
                            </div>
                            <div class="PhotoChooser-Upload">
                                <input id="photo-upload" type="radio" class="RadioChoice" name="photo-option" value="upload" checked="${1 if selected == 'upload' else None}"/>
                                <label for="photo-upload">
                                    <span class="label-top">Choisir une photo</span>
                                    <input name="image_path" type="file" />
                                </label>
                            </div>
                        </div>

                        <textarea name="reason" placeholder="Pourquoi soutenez-vous la Convention ? (facultatif)"></textarea>
                        <p class="form-section-explanation">
                            Votre raison pourrait être celle qui résonne !
                        </p>

                        <div class="BlockBg-Footer  u-Flex u-Flex-justifyBetween">
                            <button class="btn btn-secondary" name="skip" type="submit">Passer cette étape</button>
                            <button class="btn" type="submit">Continuer</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</py:block>
</py:extends>
